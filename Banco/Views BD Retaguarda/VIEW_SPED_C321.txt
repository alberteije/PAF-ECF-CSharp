	CREATE
	VIEW t2tierp.VIEW_SPED_C321
	AS
	(
	select 
		CAST( CONCAT(NF2C.ID,NF2D.ID,P.ID) as UNSIGNED) as ID,
		NF2D.ID_PRODUTO, 
		U.SIGLA AS DESCRICAO_UNIDADE, 
		NF2C.DATA_EMISSAO,
		SUM(NF2D.QUANTIDADE) AS SOMA_QUANTIDADE, 
		SUM(NF2D.VALOR_TOTAL) AS SOMA_ITEM, 
		SUM(NF2D.DESCONTO) AS SOMA_DESCONTO, 
		SUM(NF2D.BASE_ICMS) AS SOMA_BASE_ICMS, 
		SUM(NF2D.ICMS) AS SOMA_ICMS, 
		SUM(NF2D.PIS) AS SOMA_PIS, 
		SUM(NF2D.COFINS) AS SOMA_COFINS 
	from 
		ECF_NOTA_FISCAL_DETALHE NF2D, ECF_NOTA_FISCAL_CABECALHO NF2C, PRODUTO P, UNIDADE_PRODUTO U 
	where 
		NF2D.ID_NF_CABECALHO = NF2C.ID and 
		NF2D.ID_PRODUTO = P.ID and 
		P.ID_UNIDADE_PRODUTO = U.ID
	group by 
		ID_PRODUTO
	)